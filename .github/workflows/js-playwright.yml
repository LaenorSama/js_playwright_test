name: Allure Report
run-name: ${{ github.actor }} is creating Allure report üöÄ

# –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
env:
    ALLURE_ENDPOINT: https://demo.qatools.cloud/
    ALLURE_PROJECT_ID: 165
    ALLURE_TOKEN: ${{ secrets.ALLURE_TOKEN }}
    ALLURE_JOB_RUN_ID: ${{ github.event.inputs.ALLURE_JOB_RUN_ID }}
    ALLURE_RESULTS: "./out/allure-results"
    
on:
  #push:
  #  branches-ignore:
  #    - '!main'

# –≤—Ä—É—á–Ω—É—é    
  workflow_dispatch:
    inputs:
      BROWSER:
        description: Browser
        required: false
        default: "OperaGX"
      OS:
        description: OS
        required: false
        default: "Win_11"



permissions: write-all

jobs:
  autotests:
    name: Run tests and generate Allure Report 
    runs-on: ubuntu-latest

    steps:
    # —á–µ–∫–∞—É—Ç
      - name: Clone repository
        uses: actions/checkout@v4.2.2

    # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ node.js –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      - name: Set up Node 20
        uses: actions/setup-node@v4.1.0
        with:
          node-version: 20
          cache: npm

      - name: Install npm
        run: npm install

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º allurectl —á–µ—Ä–µ–∑ GitHub Action
      - name: Install allurectl
        uses: allure-framework/setup-allurectl@v1
        with:
          allure-endpoint: ${{ env.ALLURE_ENDPOINT }}
          allure-token: ${{ env.ALLURE_TOKEN }}
          allure-project-id: ${{ env.ALLURE_PROJECT_ID }}

      - name: Run tests with Allure TestOps
        run: allurectl watch -- npm test
        continue-on-error: true
        env:
      #      BRANCH: ${{ github.ref_name }}
            ENDPOINT: ${{ env.ALLURE_ENDPOINT }}
      #      BROWSER: ${{ github.event.inputs.BROWSER}}
      #      OS: ${{ github.event.inputs.OS}}
    
      #- name: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å allurectl
      #  run: allurectl watch -- npx playwright test --no-testplan 
      #  env:
      #      BRANCH: ${{ github.ref_name }}
      #      ENDPOINT: ${{ env.ALLURE_ENDPOINT }}
      #      BROWSER: ${{ github.event.inputs.BROWSER}}
      #      OS: ${{ github.event.inputs.OS}}
